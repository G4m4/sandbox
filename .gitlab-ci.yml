# As seen on https://gitlab.com/gitlab-examples/cpp-example/-/blob/master/.gitlab-ci.yml

image: gcc

stages:
  - build
  - test
  # - deploy

build:linux:
  stage: build
  # tags:
  #   - linux
  before_script:
    - apt update && apt -y install make autoconf cmake doxygen
  script:
    - mkdir build
    - cd build
    - cmake ..
    - make
  artifacts:
    expire_in: 2 hrs
    paths:
      - build/

# build:windows:
#   stage: build
#   tags:
#     - windows
#   script:
#     - mkdir build
#     - cd build
#     - '"C:\Program Files\CMake\bin\cmake.exe" -G "Visual Studio 15 2017 Win64" -DBUILD_LIBTIFF=ON ..'
#     - '"C:\Program Files\CMake\bin\cmake.exe" ..'
#     - '"C:\Program Files\CMake\bin\cmake.exe" --build . --config Release --target ALL_BUILD'
#   artifacts:
#     expire_in: 2 hrs
#     paths:
#       - build/

# Run unit test
test:linux:
  stage: test
  # tags:
  #   - linux
  script:
    - ./build/sandbox/implementation/standalone/sandbox
  dependencies:
    - build:linux

# # Build and Push Docker Image
# build:docker:
#   stage: deploy
#   when: on_success
#   only:
#     - master
#   image: docker:stable
#   services:
#     - docker:dind
#   script:
#     - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY
#     - docker build -t $CI_REGISTRY_IMAGE .
#     - docker push $CI_REGISTRY_IMAGE
#   dependencies:
#     - build:linux
